define(["codemirror/lib/codemirror","js-beautify/js/lib/beautify","js-beautify/js/lib/beautify-html","js-beautify/js/lib/beautify-css","../var/plugin"],function(CodeMirror,jsBeautify,htmlBeautify,cssBeautify,plugin){"use strict";var code={format:function(type,source){var beautifier="html"===type?htmlBeautify:cssBeautify;return beautifier[type+"_beautify"](source,{indent_size:plugin.settings.indentUnit,wrap_line_length:plugin.settings.lineLength||100})},completeAfter:function(cm,pred){pred&&!pred()||setTimeout(function(){cm.state.completionActive||cm.showHint({completeSingle:!1})},100);return CodeMirror.Pass},completeIfAfterLt:function(cm){return code.completeAfter(cm,function(){var cur=cm.getCursor();return"<"===cm.getRange(CodeMirror.Pos(cur.line,cur.ch-1),cur)})},completeIfInTag:function(cm){return code.completeAfter(cm,function(){var inner,tok=cm.getTokenAt(cm.getCursor());if("string"===tok.type&&(!/['"]/.test(tok.string.charAt(tok.string.length-1))||1===tok.string.length))return!1;inner=CodeMirror.innerMode(cm.getMode(),tok.state).state;return inner.tagName})}};return code});