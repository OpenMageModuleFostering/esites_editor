!function(){function ltrim(s){return s.replace(/^\s+/g,"")}function rtrim(s){return s.replace(/\s+$/g,"")}function style_html(html_source,options,js_beautify,css_beautify){function Parser(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.newlines=0;this.indent_content=indent_inner_html;this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,source,!doctype,basefont,base,area,hr,wbr,param,img,isindex,embed".split(","),extra_liners:extra_liners,in_array:function(what,arr){for(var i=0;i<arr.length;i++)if(what===arr[i])return!0;return!1}};this.is_whitespace=function(text){for(var n=0;n<text.length;text++)if(!this.Utils.in_array(text.charAt(n),this.Utils.whitespace))return!1;return!0};this.traverse_whitespace=function(){var input_char="";input_char=this.input.charAt(this.pos);if(this.Utils.in_array(input_char,this.Utils.whitespace)){this.newlines=0;for(;this.Utils.in_array(input_char,this.Utils.whitespace);){preserve_newlines&&"\n"===input_char&&this.newlines<=max_preserve_newlines&&(this.newlines+=1);this.pos++;input_char=this.input.charAt(this.pos)}return!0}return!1};this.space_or_wrap=function(content){if(this.line_char_count>=this.wrap_line_length){this.print_newline(!1,content);this.print_indentation(content)}else{this.line_char_count++;content.push(" ")}};this.get_content=function(){for(var input_char="",content=[];"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return content.length?content.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(content);else{if(indent_handlebars){var peek3=this.input.substr(this.pos,3);if("{{#"===peek3||"{{/"===peek3)break;if("{{!"===peek3)return[this.get_tag(),"TK_TAG_HANDLEBARS_COMMENT"];if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break}input_char=this.input.charAt(this.pos);this.pos++;this.line_char_count++;content.push(input_char)}}return content.length?content.join(""):""};this.get_contents_to=function(name){if(this.pos===this.input.length)return["","TK_EOF"];var content="",reg_match=new RegExp("</"+name+"\\s*>","igm");reg_match.lastIndex=this.pos;var reg_array=reg_match.exec(this.input),end_script=reg_array?reg_array.index:this.input.length;if(this.pos<end_script){content=this.input.substring(this.pos,end_script);this.pos=end_script}return content};this.record_tag=function(tag){if(this.tags[tag+"count"]){this.tags[tag+"count"]++;this.tags[tag+this.tags[tag+"count"]]=this.indent_level}else{this.tags[tag+"count"]=1;this.tags[tag+this.tags[tag+"count"]]=this.indent_level}this.tags[tag+this.tags[tag+"count"]+"parent"]=this.tags.parent;this.tags.parent=tag+this.tags[tag+"count"]};this.retrieve_tag=function(tag){if(this.tags[tag+"count"]){for(var temp_parent=this.tags.parent;temp_parent&&tag+this.tags[tag+"count"]!==temp_parent;)temp_parent=this.tags[temp_parent+"parent"];if(temp_parent){this.indent_level=this.tags[tag+this.tags[tag+"count"]];this.tags.parent=this.tags[temp_parent+"parent"]}delete this.tags[tag+this.tags[tag+"count"]+"parent"];delete this.tags[tag+this.tags[tag+"count"]];1===this.tags[tag+"count"]?delete this.tags[tag+"count"]:this.tags[tag+"count"]--}};this.indent_to_tag=function(tag){if(this.tags[tag+"count"]){for(var temp_parent=this.tags.parent;temp_parent&&tag+this.tags[tag+"count"]!==temp_parent;)temp_parent=this.tags[temp_parent+"parent"];temp_parent&&(this.indent_level=this.tags[tag+this.tags[tag+"count"]])}};this.get_tag=function(peek){var tag_start,tag_end,tag_start_char,input_char="",content=[],comment="",space=!1,first_attr=!0,orig_pos=this.pos,orig_line_char_count=this.line_char_count;peek=void 0!==peek?peek:!1;do{if(this.pos>=this.input.length){if(peek){this.pos=orig_pos;this.line_char_count=orig_line_char_count}return content.length?content.join(""):["","TK_EOF"]}input_char=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(input_char,this.Utils.whitespace))space=!0;else{if("'"===input_char||'"'===input_char){input_char+=this.get_unformatted(input_char);space=!0}"="===input_char&&(space=!1);if(content.length&&"="!==content[content.length-1]&&">"!==input_char&&space){this.space_or_wrap(content);space=!1;if(!first_attr&&"force"===wrap_attributes&&"/"!==input_char){this.print_newline(!0,content);this.print_indentation(content);for(var count=0;wrap_attributes_indent_size>count;count++)content.push(indent_character)}for(var i=0;i<content.length;i++)if(" "===content[i]){first_attr=!1;break}}if(indent_handlebars&&"<"===tag_start_char&&input_char+this.input.charAt(this.pos)==="{{"){input_char+=this.get_unformatted("}}");content.length&&" "!==content[content.length-1]&&"<"!==content[content.length-1]&&(input_char=" "+input_char);space=!0}if("<"===input_char&&!tag_start_char){tag_start=this.pos-1;tag_start_char="<"}if(indent_handlebars&&!tag_start_char&&content.length>=2&&"{"===content[content.length-1]&&"{"===content[content.length-2]){tag_start="#"===input_char||"/"===input_char||"!"===input_char?this.pos-3:this.pos-2;tag_start_char="{"}this.line_char_count++;content.push(input_char);if(content[1]&&("!"===content[1]||"?"===content[1]||"%"===content[1])){content=[this.get_comment(tag_start)];break}if(indent_handlebars&&content[1]&&"{"===content[1]&&content[2]&&"!"===content[2]){content=[this.get_comment(tag_start)];break}if(indent_handlebars&&"{"===tag_start_char&&content.length>2&&"}"===content[content.length-2]&&"}"===content[content.length-1])break}}while(">"!==input_char);var tag_index,tag_offset,tag_complete=content.join("");tag_index=-1!==tag_complete.indexOf(" ")?tag_complete.indexOf(" "):"{"===tag_complete.charAt(0)?tag_complete.indexOf("}"):tag_complete.indexOf(">");tag_offset="<"!==tag_complete.charAt(0)&&indent_handlebars?"#"===tag_complete.charAt(2)?3:2:1;var tag_check=tag_complete.substring(tag_offset,tag_index).toLowerCase();if("/"===tag_complete.charAt(tag_complete.length-2)||this.Utils.in_array(tag_check,this.Utils.single_token))peek||(this.tag_type="SINGLE");else if(indent_handlebars&&"{"===tag_complete.charAt(0)&&"else"===tag_check){if(!peek){this.indent_to_tag("if");this.tag_type="HANDLEBARS_ELSE";this.indent_content=!0;this.traverse_whitespace()}}else if(this.is_unformatted(tag_check,unformatted)){comment=this.get_unformatted("</"+tag_check+">",tag_complete);content.push(comment);tag_end=this.pos-1;this.tag_type="SINGLE"}else if("script"===tag_check&&(-1===tag_complete.search("type")||tag_complete.search("type")>-1&&tag_complete.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)){if(!peek){this.record_tag(tag_check);this.tag_type="SCRIPT"}}else if("style"===tag_check&&(-1===tag_complete.search("type")||tag_complete.search("type")>-1&&tag_complete.search("text/css")>-1)){if(!peek){this.record_tag(tag_check);this.tag_type="STYLE"}}else if("!"===tag_check.charAt(0)){if(!peek){this.tag_type="SINGLE";this.traverse_whitespace()}}else if(!peek){if("/"===tag_check.charAt(0)){this.retrieve_tag(tag_check.substring(1));this.tag_type="END"}else{this.record_tag(tag_check);"html"!==tag_check.toLowerCase()&&(this.indent_content=!0);this.tag_type="START"}this.traverse_whitespace()&&this.space_or_wrap(content);if(this.Utils.in_array(tag_check,this.Utils.extra_liners)){this.print_newline(!1,this.output);this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output)}}if(peek){this.pos=orig_pos;this.line_char_count=orig_line_char_count}return content.join("")};this.get_comment=function(start_pos){var comment="",delimiter=">",matched=!1;this.pos=start_pos;input_char=this.input.charAt(this.pos);this.pos++;for(;this.pos<=this.input.length;){comment+=input_char;if(comment.charAt(comment.length-1)===delimiter.charAt(delimiter.length-1)&&-1!==comment.indexOf(delimiter))break;if(!matched&&comment.length<10)if(0===comment.indexOf("<![if")){delimiter="<![endif]>";matched=!0}else if(0===comment.indexOf("<![cdata[")){delimiter="]]>";matched=!0}else if(0===comment.indexOf("<![")){delimiter="]>";matched=!0}else if(0===comment.indexOf("<!--")){delimiter="-->";matched=!0}else if(0===comment.indexOf("{{!")){delimiter="}}";matched=!0}else if(0===comment.indexOf("<?")){delimiter="?>";matched=!0}else if(0===comment.indexOf("<%")){delimiter="%>";matched=!0}input_char=this.input.charAt(this.pos);this.pos++}return comment};this.get_unformatted=function(delimiter,orig_tag){if(orig_tag&&-1!==orig_tag.toLowerCase().indexOf(delimiter))return"";var input_char="",content="",min_index=0,space=!0;do{if(this.pos>=this.input.length)return content;input_char=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(input_char,this.Utils.whitespace)){if(!space){this.line_char_count--;continue}if("\n"===input_char||"\r"===input_char){content+="\n";this.line_char_count=0;continue}}content+=input_char;this.line_char_count++;space=!0;if(indent_handlebars&&"{"===input_char&&content.length&&"{"===content.charAt(content.length-2)){content+=this.get_unformatted("}}");min_index=content.length}}while(-1===content.toLowerCase().indexOf(delimiter,min_index));return content};this.get_token=function(){var token;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var type=this.last_token.substr(7);token=this.get_contents_to(type);return"string"!=typeof token?token:[token,"TK_"+type]}if("CONTENT"===this.current_mode){token=this.get_content();return"string"!=typeof token?token:[token,"TK_CONTENT"]}if("TAG"===this.current_mode){token=this.get_tag();if("string"!=typeof token)return token;var tag_name_type="TK_TAG_"+this.tag_type;return[token,tag_name_type]}};this.get_full_indent=function(level){level=this.indent_level+level||0;return 1>level?"":Array(level+1).join(this.indent_string)};this.is_unformatted=function(tag_check,unformatted){if(!this.Utils.in_array(tag_check,unformatted))return!1;if("a"!==tag_check.toLowerCase()||!this.Utils.in_array("a",unformatted))return!0;var next_tag=this.get_tag(!0),tag=(next_tag||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!tag||this.Utils.in_array(tag,unformatted)?!0:!1};this.printer=function(js_source,indent_character,indent_size,wrap_line_length,brace_style){this.input=js_source||"";this.input=this.input.replace(/\r\n|[\r\u2028\u2029]/g,"\n");this.output=[];this.indent_character=indent_character;this.indent_string="";this.indent_size=indent_size;this.brace_style=brace_style;this.indent_level=0;this.wrap_line_length=wrap_line_length;this.line_char_count=0;for(var i=0;i<this.indent_size;i++)this.indent_string+=this.indent_character;this.print_newline=function(force,arr){this.line_char_count=0;if(arr&&arr.length&&(force||"\n"!==arr[arr.length-1])){"\n"!==arr[arr.length-1]&&(arr[arr.length-1]=rtrim(arr[arr.length-1]));arr.push("\n")}};this.print_indentation=function(arr){for(var i=0;i<this.indent_level;i++){arr.push(this.indent_string);this.line_char_count+=this.indent_string.length}};this.print_token=function(text){if(!this.is_whitespace(text)||this.output.length){if((text||""!==text)&&this.output.length&&"\n"===this.output[this.output.length-1]){this.print_indentation(this.output);text=ltrim(text)}this.print_token_raw(text)}};this.print_token_raw=function(text){this.newlines>0&&(text=rtrim(text));if(text&&""!==text)if(text.length>1&&"\n"===text.charAt(text.length-1)){this.output.push(text.slice(0,-1));this.print_newline(!1,this.output)}else this.output.push(text);for(var n=0;n<this.newlines;n++)this.print_newline(n>0,this.output);this.newlines=0};this.indent=function(){this.indent_level++};this.unindent=function(){this.indent_level>0&&this.indent_level--}};return this}var multi_parser,indent_inner_html,indent_size,indent_character,wrap_line_length,brace_style,unformatted,preserve_newlines,max_preserve_newlines,indent_handlebars,wrap_attributes,wrap_attributes_indent_size,end_with_newline,extra_liners,eol;options=options||{};void 0!==options.wrap_line_length&&0!==parseInt(options.wrap_line_length,10)||void 0===options.max_char||0===parseInt(options.max_char,10)||(options.wrap_line_length=options.max_char);indent_inner_html=void 0===options.indent_inner_html?!1:options.indent_inner_html;indent_size=void 0===options.indent_size?4:parseInt(options.indent_size,10);indent_character=void 0===options.indent_char?" ":options.indent_char;brace_style=void 0===options.brace_style?"collapse":options.brace_style;wrap_line_length=0===parseInt(options.wrap_line_length,10)?32786:parseInt(options.wrap_line_length||250,10);unformatted=options.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"];preserve_newlines=void 0===options.preserve_newlines?!0:options.preserve_newlines;max_preserve_newlines=preserve_newlines?isNaN(parseInt(options.max_preserve_newlines,10))?32786:parseInt(options.max_preserve_newlines,10):0;indent_handlebars=void 0===options.indent_handlebars?!1:options.indent_handlebars;wrap_attributes=void 0===options.wrap_attributes?"auto":options.wrap_attributes;wrap_attributes_indent_size=void 0===options.wrap_attributes_indent_size?indent_size:parseInt(options.wrap_attributes_indent_size,10)||indent_size;end_with_newline=void 0===options.end_with_newline?!1:options.end_with_newline;extra_liners="object"==typeof options.extra_liners&&options.extra_liners?options.extra_liners.concat():"string"==typeof options.extra_liners?options.extra_liners.split(","):"head,body,/html".split(",");eol=options.eol?options.eol:"\n";if(options.indent_with_tabs){indent_character="	";indent_size=1}eol=eol.replace(/\\r/,"\r").replace(/\\n/,"\n");multi_parser=new Parser;multi_parser.printer(html_source,indent_character,indent_size,wrap_line_length,brace_style);for(;;){var t=multi_parser.get_token();multi_parser.token_text=t[0];multi_parser.token_type=t[1];if("TK_EOF"===multi_parser.token_type)break;switch(multi_parser.token_type){case"TK_TAG_START":multi_parser.print_newline(!1,multi_parser.output);multi_parser.print_token(multi_parser.token_text);if(multi_parser.indent_content){multi_parser.indent();multi_parser.indent_content=!1}multi_parser.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":multi_parser.print_newline(!1,multi_parser.output);multi_parser.print_token(multi_parser.token_text);multi_parser.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===multi_parser.last_token&&""===multi_parser.last_text){var tag_name=multi_parser.token_text.match(/\w+/)[0],tag_extracted_from_last_output=null;multi_parser.output.length&&(tag_extracted_from_last_output=multi_parser.output[multi_parser.output.length-1].match(/(?:<|{{#)\s*(\w+)/));(null===tag_extracted_from_last_output||tag_extracted_from_last_output[1]!==tag_name&&!multi_parser.Utils.in_array(tag_extracted_from_last_output[1],unformatted))&&multi_parser.print_newline(!1,multi_parser.output)}multi_parser.print_token(multi_parser.token_text);multi_parser.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var tag_check=multi_parser.token_text.match(/^\s*<([a-z-]+)/i);tag_check&&multi_parser.Utils.in_array(tag_check[1],unformatted)||multi_parser.print_newline(!1,multi_parser.output);multi_parser.print_token(multi_parser.token_text);multi_parser.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":multi_parser.print_token(multi_parser.token_text);if(multi_parser.indent_content){multi_parser.indent();multi_parser.indent_content=!1}multi_parser.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_COMMENT":multi_parser.print_token(multi_parser.token_text);multi_parser.current_mode="TAG";break;case"TK_CONTENT":multi_parser.print_token(multi_parser.token_text);multi_parser.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==multi_parser.token_text){multi_parser.print_newline(!1,multi_parser.output);var _beautifier,text=multi_parser.token_text,script_indent_level=1;"TK_SCRIPT"===multi_parser.token_type?_beautifier="function"==typeof js_beautify&&js_beautify:"TK_STYLE"===multi_parser.token_type&&(_beautifier="function"==typeof css_beautify&&css_beautify);"keep"===options.indent_scripts?script_indent_level=0:"separate"===options.indent_scripts&&(script_indent_level=-multi_parser.indent_level);var indentation=multi_parser.get_full_indent(script_indent_level);if(_beautifier){var Child_options=function(){this.eol="\n"};Child_options.prototype=options;var child_options=new Child_options;text=_beautifier(text.replace(/^\s*/,indentation),child_options)}else{var white=text.match(/^\s*/)[0],_level=white.match(/[^\n\r]*$/)[0].split(multi_parser.indent_string).length-1,reindent=multi_parser.get_full_indent(script_indent_level-_level);text=text.replace(/^\s*/,indentation).replace(/\r\n|\r|\n/g,"\n"+reindent).replace(/\s+$/,"")}if(text){multi_parser.print_token_raw(text);multi_parser.print_newline(!0,multi_parser.output)}}multi_parser.current_mode="TAG";break;default:""!==multi_parser.token_text&&multi_parser.print_token(multi_parser.token_text)}multi_parser.last_token=multi_parser.token_type;multi_parser.last_text=multi_parser.token_text}var sweet_code=multi_parser.output.join("").replace(/[\r\n\t ]+$/,"");end_with_newline&&(sweet_code+="\n");"\n"!=eol&&(sweet_code=sweet_code.replace(/[\n]/g,eol));return sweet_code}if("function"==typeof define&&define.amd)define(["require","./beautify","./beautify-css"],function(requireamd){var js_beautify=requireamd("./beautify"),css_beautify=requireamd("./beautify-css");return{html_beautify:function(html_source,options){return style_html(html_source,options,js_beautify.js_beautify,css_beautify.css_beautify)}}});else if("undefined"!=typeof exports){var js_beautify=require("./beautify.js"),css_beautify=require("./beautify-css.js");exports.html_beautify=function(html_source,options){return style_html(html_source,options,js_beautify.js_beautify,css_beautify.css_beautify)}}else"undefined"!=typeof window?window.html_beautify=function(html_source,options){return style_html(html_source,options,window.js_beautify,window.css_beautify)}:"undefined"!=typeof global&&(global.html_beautify=function(html_source,options){return style_html(html_source,options,global.js_beautify,global.css_beautify)})}();